<!DOCTYPE html>
<html class='v2' dir='ltr' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/521441841-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='https://kristerw.blogspot.com/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Krister Walfridsson&#8217;s blog - Atom" href="https://kristerw.blogspot.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Krister Walfridsson&#8217;s blog - RSS" href="https://kristerw.blogspot.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Krister Walfridsson&#8217;s blog - Atom" href="https://www.blogger.com/feeds/2420869991974935734/posts/default" />

<link rel="alternate" type="application/atom+xml" title="Krister Walfridsson&#8217;s blog - Atom" href="https://kristerw.blogspot.com/feeds/8730968594439269409/comments/default" />
<!--[if IE]><script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/35781802-ieretrofit.js"></script>
<![endif]-->
<link href='https://plus.google.com/115659629692746830116' rel='publisher'/>
<meta content='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html' property='og:url'/>
<meta content='How undefined signed overflow enables optimizations in GCC' property='og:title'/>
<meta content=' Signed integers are not allowed to overflow in C and C++, and this helps compilers generate better code. I was interested in how GCC is tak...' property='og:description'/>
<!--[if IE]> <script> (function() { var html5 = ("abbr,article,aside,audio,canvas,datalist,details," + "figure,footer,header,hgroup,mark,menu,meter,nav,output," + "progress,section,time,video").split(','); for (var i = 0; i < html5.length; i++) { document.createElement(html5[i]); } try { document.execCommand('BackgroundImageCache', false, true); } catch(e) {} })(); </script> <![endif]-->
<title>Krister Walfridsson&#8217;s blog: How undefined signed overflow enables optimizations in GCC</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */

/* Content
----------------------------------------------- */
body {
font: normal normal 12px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #666666;
background: #ffffff none repeat scroll top left;
padding: 0 0 0 0;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2288bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #33aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 #333333;
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 40px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 40px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
color: #000000;
text-shadow: 0 0 0 rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #000000;
}
.Header .description {
font-size: 18px;
color: #000000;
}
.header-inner .Header .titlewrapper {
padding: 22px 0;
}
.header-inner .Header .descriptionwrapper {
padding: 0 0;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 0 solid #dddddd;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #dddddd;
border-left: 1px solid #dddddd;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget ul {
background: transparent none repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #dddddd;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 12px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #000000;
border-left: 1px solid #ffffff;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid transparent;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid transparent;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid transparent;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: #bbbbbb;
color: #ffffff;
padding: 0.4em;
letter-spacing: 3px;
margin: inherit;
}
.main-inner {
padding-top: 35px;
padding-bottom: 65px;
}
.main-inner .column-center-inner {
padding: 0 0;
}
.main-inner .column-center-inner .section {
margin: 0 1em;
}
.post {
margin: 0 0 45px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: transparent;
border: 1px solid transparent;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #666666;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #eeeeee;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid transparent;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid transparent;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #eeeeee;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid transparent;
}
.blog-pager {
background: transparent url(//www.blogblog.com/1kt/simple/paging_dot.png) repeat-x scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 1px dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #666666;
}
.mobile-link-button {
background-color: #2288bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #dddddd;
border-bottom: 1px solid #dddddd;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #dddddd;
}
pre.code-snippet {
padding-left: 5%;
overflow:auto;
}
.post-body img, .post-body .tr-caption-container {
padding: 0 !important;
background: none !important;  border: none !important;
-webkit-box-shadow: 0px 0px 0px transparent !important;
-moz-box-shadow: 0px 0px 0px transparent !important;
box-shadow: 0px 0px 0px transparent !important;
}
--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1000px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1000px;
max-width: 1000px;
_width: 1000px;
}
.main-inner .columns {
padding-left: 0px;
padding-right: 260px;
}
.main-inner .fauxcolumn-center-outer {
left: 0px;
right: 260px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0px") -
parseInt("260px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0px;
}
.main-inner .fauxcolumn-right-outer {
width: 260px;
}
.main-inner .column-left-outer {
width: 0px;
right: 100%;
margin-left: -0px;
}
.main-inner .column-right-outer {
width: 260px;
margin-right: -260px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
--></style>
<script type='text/javascript'>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-83654896-1', 'auto', 'blogger');
        ga('blogger.send', 'pageview');
      </script>
<script async='async' src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML,Safe' type='text/javascript'>
    </script>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2420869991974935734&amp;zx=a960e3c4-83b3-4381-b16b-ee0145e14bdf' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2420869991974935734&amp;zx=a960e3c4-83b3-4381-b16b-ee0145e14bdf' rel='stylesheet'/></noscript>
</head>
<script>
document.onreadystatechange = function () {
  if (document.readyState == "interactive") {

    var orig = document.getElementById("main");
    var clone = orig.cloneNode(true);
    orig.parentNode.replaceChild(clone, orig);
  }
}
</script>
<body class='loading variant-simplysimple'>
<div class='navbar section' id='navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d2420869991974935734\x26blogName\x3dKrister+Walfridsson%E2%80%99s+blog\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dLIGHT\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttps://kristerw.blogspot.com/search\x26blogLocale\x3den\x26v\x3d2\x26homepageUrl\x3dhttps://kristerw.blogspot.com/\x26targetPostID\x3d8730968594439269409\x26blogPostOrPageUrl\x3dhttps://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html\x26vt\x3d-5951195986852763575',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='https://kristerw.blogspot.com/'>
Krister Walfridsson&#8217;s blog
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>Random thoughts on programming languages, compilers, operating systems, etc.</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol'></div>
<div class='tabs no-items section' id='crosscol-overflow'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Sunday, February 21, 2016</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='2420869991974935734' itemprop='blogId'/>
<meta content='8730968594439269409' itemprop='postId'/>
<a name='8730968594439269409'></a>
<h3 class='post-title entry-title' itemprop='name'>
How undefined signed overflow enables optimizations in GCC
</h3>
<meta content='@kwalfridsson' name='twitter:site'/>
<meta content='https://kristerw.blogspot.com/' name='twitter:domain'/>
<meta content='How undefined signed overflow enables optimizations in GCC' name='twitter:title'/>
<meta content='summary' name='twitter:card'/>
<meta content='How undefined signed overflow enables optimizations in GCC' name='twitter:title'/>
<meta content=' Signed integers are not allowed to overflow in C and C++, and this helps compilers generate better code. I was interested in how GCC is tak...' name='twitter:description'/>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-8730968594439269409' itemprop='description articleBody'>
<div style="text-align: justify;">
Signed integers are not allowed to overflow in C and C++, and this helps compilers generate better code. I was interested in how GCC is taking advantage of this, and here are my findings.<sup>1</sup></div>
<div style="text-align: justify;">
<br /></div>
<h4 style="text-align: justify;">
Signed integer expression simplification</h4>
<div style="text-align: justify;">
The nice property of overflow being undefined is that signed integer operations works as in normal mathematics &#8212; you can cancel out values so that <code>(x*10)/5</code> simplifies to <code>x*2</code>, or (<code>x+1)&lt;(y+3)</code> simplifies to <code>x&lt;(y+2)</code>. Increasing a value always makes it larger, so <code>x&lt;(x+1)</code> is always true.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
GCC iterates over the IR (the compiler's Internal Representation of the program), and does the following transformations (<code>x</code>, and <code>y</code> are signed integers, <code>c</code>, <code>c1</code>, and <code>c2</code> are positive constants, and <code>cmp</code> is a comparison operator. I have only listed the transformations for positive constants, but GCC handles negative constants too in the obvious way)<br />
<ul>
<li>Eliminate multiplication in comparison with 0
<pre class="code-snippet">(x * c) cmp 0   -&gt;   x cmp 0 
</pre>
</li>
<li>Eliminate division after multiplication<br /><pre class="code-snippet">(x * c1) / c2   -&gt;   x * (c1 / c2) <span style="font-family: &quot;georgia&quot; , &quot;times new roman&quot; , serif;">if</span> c1 <span style="font-family: &quot;georgia&quot; , &quot;times new roman&quot; , serif;">is divisible by</span> c2
</pre>
</li>
<li>Eliminate negation
<pre class="code-snippet">(-x) / (-y)     -&gt;   x / y
</pre>
</li>
<li>Simplify comparisons that are always true or false
<pre class="code-snippet">x + c &lt; x       -&gt;   false
x + c &lt;= x      -&gt;   false
x + c &gt; x       -&gt;   true
x + c &gt;= x      -&gt;   true
</pre>
</li>
<li>Eliminate negation in comparisons
<pre class="code-snippet">(-x) cmp (-y)   -&gt;   y cmp x
</pre>
</li>
<li>Reduce magnitude of constants
<pre class="code-snippet">x + c &gt; y       -&gt;   x + (c - 1) &gt;= y
x + c &lt;= y      -&gt;   x + (c - 1) &lt; y
</pre>
</li>
<li>Eliminate constants in comparisons
<pre class="code-snippet">(x + c1) cmp c2         -&gt;   x cmp (c2 - c1)
(x + c1) cmp (y + c2)   -&gt;   x cmp (y + (c2 - c1)) <span style="font-family: &quot;georgia&quot; , &quot;times new roman&quot; , serif;">if</span> c1 &lt;= c2
</pre>
The second transformation is only valid if <code>c1 &lt;= c2</code>, as it would otherwise introduce an overflow when <code>y</code> has the value <code>INT_MIN</code>.
</li>
</ul>
</div>
<br />
<h4 style="text-align: justify;">
Pointer arithmetic and type promotion</h4>
<div style="text-align: justify;">
If an operation does not overflow, then we will get the same result if we do the operation in a wider type. This is often useful when doing things like array indexing on 64-bit architectures &#8212; the index calculations are typically done using 32-bit <code>int</code>, but the pointers are 64-bit, and the compiler may generate more efficient code when signed overflow is undefined by promoting the 32-bit integers to 64-bit operations instead of generating type extensions. <br />
<br />
One other aspect of this is that undefined overflow ensures that <code>a[i]</code> and <code>a[i+1]</code> are adjacent. This improves analysis of memory accesses for vectorization etc.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
<h4>
Value range calculations</h4>
</div>
<div style="text-align: justify;">
The compiler keeps track of the variables' range of possible values at each point in the program, i.e. for code such as</div>
<pre class="code-snippet"><span style="color: #00aaaa;">int</span> x = foo();
<span style="color: #0000aa;">if</span> (x &gt; <span style="color: #009999;">0</span>) {
  <span style="color: #00aaaa;">int</span> y = x + <span style="color: #009999;">5</span>;
  <span style="color: #00aaaa;">int</span> z = y / <span style="color: #009999;">4</span>;
</pre>
<div style="text-align: justify;">
it determines that <code>x</code> has the range <code>[1, INT_MAX]</code> after the if-statement, and can thus determine that <code>y</code> has the range <code>[6, INT_MAX]</code> as overflow is not allowed. And the next line can be optimized to
</div>
<div style="text-align: justify;">
<pre class="code-snippet">  <span style="color: #00aaaa;">int</span> z = y &gt;&gt; <span style="color: #009999;">2</span>;
</pre>
as the compiler knows that <code>y</code> is non-negative.</div>
<div style="text-align: justify;">
<br />
The undefined overflow helps optimizations that need to compare two values (as the wrapping case would give possible values of the form <code>[INT_MIN, (INT_MIN+4)]</code> or <code>[6, INT_MAX]</code> that prevents all useful comparisons with <code>&lt;</code> or <code>&gt;</code>), such as<br />
<ul>
<li>Changing comparisons <code>x&lt;y</code> to true or false if the ranges for <code>x</code> and <code>y</code> does not overlap</li>
<li>Changing <code>min(x,y)</code> or <code>max(x,y)</code> to <code>x</code> or <code>y</code> if the ranges do not overlap</li>
<li>Changing <code>abs(x)</code> to <code>x</code> or <code>-x</code> if the range does not cross 0</li>
<li>Changing <code>x/c</code> to <code>x&gt;&gt;log2(c)</code> if <code>x&gt;0</code> and the constant <code>c</code> is a power of 2</li>
<li>Changing <code>x%c</code> to <code>x&amp;(c-1)</code> if <code>x&gt;0</code> and the constant <code>c</code> is a power of 2</li>
</ul>
</div>
<br />
<h4 style="text-align: justify;">
Loop analysis and optimization</h4>
<div style="text-align: justify;">
The canonical example of why undefined signed overflow helps loop optimizations is that loops like
<br />
<pre class="code-snippet"><span style="color: #0000aa;">for</span> (<span style="color: #00aaaa;">int</span> i = <span style="color: #009999;">0</span>; i &lt;= m; i++)
</pre>
are guaranteed to terminate for undefined overflow. This helps architectures that have specific loop instructions, as they do in general not handle infinite loops.<br />
<br />
But undefined signed overflow helps many more loop optimizations. All analysis such as determining number of iteration, transforming induction variables, and keeping track of memory accesses are using everything in the previous sections in order to do its work. In particular, the set of loops that can be vectorized are severely reduced when signed overflow is allowed.</div>
<div style="text-align: justify;">
<br /></div>
<hr />
<div style="text-align: justify;">
1. Using GCC trunk r233186,&nbsp; "gcc version 6.0.0 20160205 (experimental)"<br />
<br />
<i>This blog post was updated 2016-02-23:</i><br />
<ul>
<li><i>Corrected first sentence to say "overflow"instead of "wrap".</i></li>
<li><i>Removed one incorrect transformation from "Eliminate Negation" where I had misread the GCC source code.</i></li>
<li><i>Corrected the ranges in the "Value range calculations" example.</i></li>
</ul>
</div>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'><span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://plus.google.com/115659629692746830116' itemprop='url'/>
<a class='g-profile' href='https://plus.google.com/115659629692746830116' rel='author' title='author profile'>
<span itemprop='name'>Krister Walfridsson</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html' itemprop='url'/>
<a class='timestamp-link' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2016-02-21T16:07:00+01:00'>Sunday, February 21, 2016</abbr></a>
</span>
<span class='post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1878224168'>
<a href='https://www.blogger.com/post-edit.g?blogID=2420869991974935734&postID=8730968594439269409&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=2420869991974935734&postID=8730968594439269409&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=2420869991974935734&postID=8730968594439269409&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=2420869991974935734&postID=8730968594439269409&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=2420869991974935734&postID=8730968594439269409&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=2420869991974935734&postID=8730968594439269409&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a><div class='goog-inline-block google-plus-share-container'><g:plusone source='blogger:blog:plusone' href='http://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html' size='medium' width='300' annotation='inline'/></div>
</div>
</div>
<div class='post-footer-line post-footer-line-2'><span class='post-labels'>
Labels:
<a href='https://kristerw.blogspot.com/search/label/C' rel='tag'>C</a>,
<a href='https://kristerw.blogspot.com/search/label/GCC' rel='tag'>GCC</a>,
<a href='https://kristerw.blogspot.com/search/label/undefined%20behavior' rel='tag'>undefined behavior</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'></div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>16 comments:</h4>
<div class='comments-content'>
<script async='async' src='//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js' type='text/javascript'></script>
<script type='text/javascript'>
    (function() {
      var items = [{'id': '7602495102647553779', 'body': 'Nice writeup.\x3cbr /\x3eThese optimizations also mean UNsigned integers should only be used when really needed. E.g. when you need the overflow wrap around.', 'timestamp': '1456121061202', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456121061202#c7602495102647553779', 'author': {'name': 'Koen Vos', 'avatarUrl': '//lh4.googleusercontent.com/-Q3qpoOJ2OV4/AAAAAAAAAAI/AAAAAAAAaLU/qkLTIp1kkts/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/12219383030985540061'}, 'displayTime': 'February 22, 2016 at 7:04 AM', 'deleteclass': 'item-control blog-admin pid-171330755'}, {'id': '4243935719181113598', 'body': 'In \x26quot;Value range calculations\x26quot; shouldn\x26#39;t it be\x3cbr /\x3e\x3cbr /\x3e    (0, INT_MAX]\x3cbr /\x3e\x3cbr /\x3einstead of\x3cbr /\x3e\x3cbr /\x3e    [0, INT_MAX]\x3cbr /\x3e\x3cbr /\x3ebecause the if-statement checks to make sure x \x26gt; 0, not x \x26gt;\x3d 0?\x3cbr /\x3e\x3cbr /\x3eGreat write-up!\x3cbr /\x3e', 'timestamp': '1456123345216', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456123345216#c4243935719181113598', 'author': {'name': 'Eric Lagergren', 'avatarUrl': '//lh5.googleusercontent.com/-IJeEdrxo51U/AAAAAAAAAAI/AAAAAAAAC5g/jWdgZY43ufQ/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/12416085733314329967'}, 'displayTime': 'February 22, 2016 at 7:42 AM', 'deleteclass': 'item-control blog-admin pid-352747736'}, {'id': '5534126643132454622', 'body': 'Thanks!  I have updated the ranges in the blog post.', 'timestamp': '1456137774557', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456137774557#c5534126643132454622', 'author': {'name': 'Krister Walfridsson', 'avatarUrl': '//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/02591279630933941271'}, 'displayTime': 'February 22, 2016 at 11:42 AM', 'deleteclass': 'item-control blog-admin pid-1878224168'}, {'id': '6818138626117414265', 'body': 'I\x26#39;m afraid that as regards the C++ language you\x26#39;ve fallen victim to some purely associative propaganda, I\x26#39;m sorry: very few of the opportunities you list, are examples where the UB contributes to optimization of actual C++ code.\x3cbr /\x3e\x3cbr /\x3e[Snipped concrete discussion of first 7 cases, because that exceeded the 4096 character limit on postings. Conclusion: only 6 and 7 are real. Silly limit! Gag the critics!]\x3cbr /\x3e\x3cbr /\x3e***\x3cbr /\x3e\x3cbr /\x3eOkay there are more cases, and loops are especially interesting. They offer some valid good optimizations, and some that are more in the class of perverse compiler behavior (which you can just take as my personal opinion, or investigate, sorry I don\x26#39;t have more time here). But in conclusion, the optimization possibilities offered by signed arithmetic UB, are somewhat hyped up: there are some such possibilities, even some good ones, but many alleged ones are not really optimizations at all.\x3cbr /\x3e\x3cbr /\x3eStill there are good reasons for preferentially using signed integers for numbers, and those good reasons include both clarity (less complexity, more concise code), and less opportunities for e.g. promotion bugs to creep in.\x3cbr /\x3e\x3cbr /\x3eCheers!', 'timestamp': '1456168701646', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456168701646#c6818138626117414265', 'author': {'name': 'Alf P. Steinbach', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/07587892946798135052'}, 'displayTime': 'February 22, 2016 at 8:18 PM', 'deleteclass': 'item-control blog-admin pid-2046834556'}, {'id': '7911937670428840961', 'body': 'Hi Alf,\x3cbr /\x3e\x3cbr /\x3esigned overflow is undefined behavior in C++ too, and GCC does all of the described transformations for both C and C++.\x3cbr /\x3e\x3cbr /\x3eWe may argue about the benefit of these transformations, but I think that is a topic for a separate blog post... :-)\x3cbr /\x3e', 'timestamp': '1456184448777', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456184448777#c7911937670428840961', 'author': {'name': 'Krister Walfridsson', 'avatarUrl': '//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/02591279630933941271'}, 'displayTime': 'February 23, 2016 at 12:40 AM', 'deleteclass': 'item-control blog-admin pid-1878224168'}, {'id': '2790380421495058725', 'body': 'Oh. You misunderstood. I mentioned the language because a comment argument for optimization of sillycodes like `x*Constant \x26gt; x` (in one of your examples) is that such code can be generated by macros. Those are at best a C-specific arguments; there is no reason a sane C++ programmer would do this, or indeed, need to have it optimized.\x3cbr /\x3e\x3cbr /\x3eCheers \x26amp; hth.,\x3cbr /\x3e\x3cbr /\x3e- Alf', 'timestamp': '1456187662148', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456187662148#c2790380421495058725', 'author': {'name': 'Alf P. Steinbach', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/07587892946798135052'}, 'displayTime': 'February 23, 2016 at 1:34 AM', 'deleteclass': 'item-control blog-admin pid-2046834556'}, {'id': '1917980528307417386', 'body': '@Krister, nice article!\x3cbr /\x3e\x3cbr /\x3e@Alf, I think you are underestimating the amount of C++ code written by non-humans. Many code generators produce idioms like this. Convoluted template shenanigans can also lead to such expressions appearing in a translation unit.\x3cbr /\x3e\x3cbr /\x3e@Koen, yes and no. Unsigned types are much easier to reason about in many situations. It is true that there are cases like the one Krister identified where an optimisation is only enabled when operating on signed types. However, there are so many cases of undefined behaviour relating to signed but not unsigned types that it can be a minefield for the insufficiently cautious programmer. E.g. `1 \x26lt;\x26lt; 31`, `INT_MIN / -1`, ...', 'timestamp': '1456214423138', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456214423138#c1917980528307417386', 'author': {'name': 'Matthew Fernandez', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/06893028044755694147'}, 'displayTime': 'February 23, 2016 at 9:00 AM', 'deleteclass': 'item-control blog-admin pid-2073609546'}, {'id': '885274766153389474', 'body': '@Koen: I second what Matthew is saying.  The standard says that signed overflow leads to undefined behavior.  This is because the IBM 360 and successors trapped on signed integer overflow.\x3cbr /\x3e\x3cbr /\x3eSince undefined behavior can be anything, programmers must avoid creating such code.\x3cbr /\x3e\x3cbr /\x3eThus, modern instances of GCC and other compilers assume that programmers are infallible and have ensured that their code does not cause overflow, hence giving the compilers license to perform these optimizations.\x3cbr /\x3e\x3cbr /\x3eIf however, the code was written with the assumption that signed overflow is treated exactly like unsigned arithmetic, as was the case for previous instances of these compilers on most machines, these optimization can cause the code to fail.\x3cbr /\x3e\x3cbr /\x3eAlthough I can understand compiler writers\x26#39; interest in implementing these optimizations, one hast to wonder if a programmer that creates code with such obvious optimization opportunities has really thought through his code, e.g., in regards to integer overflow.\x3cbr /\x3e\x3cbr /\x3eAnd honestly, I think programmers would be better served by having code generated that traps on overflow, at least for debug builds.', 'timestamp': '1456396115127', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456396115127#c885274766153389474', 'author': {'name': 'Konz', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/06061640618369768590'}, 'displayTime': 'February 25, 2016 at 11:28 AM', 'deleteclass': 'item-control blog-admin pid-1541573582'}, {'id': '874743058848513818', 'body': '@Konz In some cases of undefined behavior gcc and clang may use  __builtin_trap which let\x26#39;s say on x86 may generate a ud2 instruction which will trap. They both currently do this when dereferencing a null pointer see this godbolt example: https://goo.gl/VoV7zH\x3cbr /\x3e\x3cbr /\x3eThe compiler may not always be able to prove undefined behavior, on a stackoverflow question I answered a while ago: http://stackoverflow.com/q/32506643/1708801 \x3cbr /\x3e\x3cbr /\x3eA simple cout of the variable was sufficient to confuse the compiler and prevent a warning of undefined behavior. Although the optimizer still managed to turn a finite loop into an infinite one in this case.', 'timestamp': '1456446037148', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1456446037148#c874743058848513818', 'author': {'name': 'justesting', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/14682465709740969828'}, 'displayTime': 'February 26, 2016 at 1:20 AM', 'deleteclass': 'item-control blog-admin pid-922999406'}, {'id': '4874005006181033965', 'body': 'This is wrong for the case y \x3d -1:\x3cbr /\x3e(-x) / (-y)     -\x26gt;   x / y\x3cbr /\x3e\x3cbr /\x3esince with y \x3d -1 the optimized code would crash when x \x3d INT_MAX  (the CPU traps).', 'timestamp': '1457286776014', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1457286776014#c4874005006181033965', 'author': {'name': 'Nuno Lopes', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/09213668605490237138'}, 'displayTime': 'March 6, 2016 at 6:52 PM', 'deleteclass': 'item-control blog-admin pid-225537378'}, {'id': '2932635155683498927', 'body': 'Is it common to see loop like\x3cbr /\x3e\x3cbr /\x3efor (int i \x3d 0; i \x26lt;\x3d m; i++)\x3cbr /\x3e\x3cbr /\x3e?\x3cbr /\x3e\x3cbr /\x3e\x26quot;Most\x26quot;[1] loops that I\x26#39;ve seen are written as\x3cbr /\x3e\x3cbr /\x3efor (int i \x3d 0; i \x26lt; m; i++)\x3cbr /\x3e\x3cbr /\x3ein which case you don\x26#39;t need UB-on-signed-overflow (you can prove no-overflow directly, even if spec is to wrap).\x3cbr /\x3e\x3cbr /\x3e[1]: In quotes since I have no way at the moment to quantify this', 'timestamp': '1459380060619', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1459380060619#c2932635155683498927', 'author': {'name': 'Sanjoy Das', 'avatarUrl': '//lh4.googleusercontent.com/-YvqX_p-_VTo/AAAAAAAAAAI/AAAAAAAAAK0/eBm7iDz3z6I/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/10580600786015660715'}, 'displayTime': 'March 31, 2016 at 1:21 AM', 'deleteclass': 'item-control blog-admin pid-2078547692'}, {'id': '1594801950215195854', 'body': 'When the when (m is unsigned) or (m is larger bit size than int), and m is greater than INT_MAX, then the loop will never terminate. (IOW the loop is not countable).', 'timestamp': '1476110668578', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1476110668578#c1594801950215195854', 'author': {'name': 'Jim Dempsey', 'avatarUrl': '//3.bp.blogspot.com/_SgvQYwGK9FU/TLYbsMAyXjI/AAAAAAAAABY/-xH3QwLk2w0/S45-s35/HeadShot.JPG', 'profileUrl': 'https://www.blogger.com/profile/05696394052049156443'}, 'displayTime': 'October 10, 2016 at 4:44 PM', 'deleteclass': 'item-control blog-admin pid-789217825'}, {'id': '5604119781768215568', 'body': 'There are a few cases where signed overflow is the desired behavior, although they aren\x26#39;t too common:\x3cbr /\x3e\x3cbr /\x3e- Generating -1 when input is negative without a branch:\x3cbr /\x3e    (int32_t)val \x26gt;\x26gt; 31; // equivalent to val \x26lt; 0 ? -1 : 0;\x3cbr /\x3e\x3cbr /\x3eFast random number generator in -128 to 127 range:\x3cbr /\x3e    int32_t randMem;\x3cbr /\x3e    randMem *\x3d 1103515245;\x3cbr /\x3e    randMem +\x3d 12345;\x3cbr /\x3e    randOut \x3d randMem \x26gt;\x26gt; 24;\x3cbr /\x3e\x3cbr /\x3eWhat\x26#39;s the proper way to get GCC to generate the proper code in this kind of case? Cast to uint32_t to force limited range, then apply wrapping arithmetic shift right? Or is there an intrinsic as in the case of stuff like 32bit * 32bit -\x26gt; 64bit multiply on 32bit architectures?', 'timestamp': '1480101851054', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1480101851054#c5604119781768215568', 'author': {'name': 'mad', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/09228282490456446770'}, 'displayTime': 'November 25, 2016 at 8:24 PM', 'deleteclass': 'item-control blog-admin pid-1344932561'}, {'id': '3093548014406783131', 'parentId': '5604119781768215568', 'body': 'There are no relevant intrinsics, but the compiler is in general smart enough to handle many interesting cases. For example, your generation of -1 if \\(\\verb!val!\\) is negative can be done as \\(\\verb!(val \x26lt; 0) ? -1 : 0!\\) &#8212; GCC generates a shift for this!\x3cbr /\x3e\x3cbr /\x3eOr you can make your operations safe by casting to larger types/unsigned etc. For example, if you have\x3cbr /\x3e\\(\\verb!int32_t a, b, c;!\\)\x3cbr /\x3ethen you can implement a wrapping addition as\x3cbr /\x3e\\(\\verb!c \x3d (int32_t)((int64_t)a + (int64_t)b);!\\)\x3cbr /\x3eGCC generates a 32-bit wrapping addition for this.\x3cbr /\x3e\x3cbr /\x3eOr you can use the \\(\\verb!-fwrapv!\\) command-line option, that treats wrapping integers as being defined (but which of course disables the optimizations described in the blog post)', 'timestamp': '1480354077131', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1480354077131#c3093548014406783131', 'author': {'name': 'Krister Walfridsson', 'avatarUrl': '//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/02591279630933941271'}, 'displayTime': 'November 28, 2016 at 6:27 PM', 'deleteclass': 'item-control blog-admin pid-1878224168'}, {'id': '8448445659490835796', 'body': 'How many genuinely-useful optimizations are enabled by treating signed overflow as UB, rather than saying that it will yield a value that behaves as any mathematical integer--not necessarily within the range of the type--whose value is congruent to the correct value mod 2&#179;&#178; (or 2&#8310;&#8308;, etc. based on type).  Such a guarantee would so far as I can tell very seldom interfere in any way with any of the optimizations you listed, but would allow programmers to write shorter and more efficient code in cases where the above behavior would satisfy application requirements, than would be possible without such a guarantee.', 'timestamp': '1487363888029', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1487363888029#c8448445659490835796', 'author': {'name': 'supercat', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/12531904492602532373'}, 'displayTime': 'February 17, 2017 at 9:38 PM', 'deleteclass': 'item-control blog-admin pid-654837207'}, {'id': '6141168780416330691', 'parentId': '8448445659490835796', 'body': 'I\x26#39;d say this is true for essentially all of the optimizations mentioned in the blog post &#8212; e.g. it uses the fact that wrapping is UB to be allowed to simplify e.g. \\(\\verb!x+1 \x26lt; x!\\) to \\(\\verb!1 \x26lt; 0!\\) by subtracting \\(\\verb!x!\\) from both sides, but the rule could be expressed as if the operation was done in a wider type.\x3cbr /\x3e\x3cbr /\x3eThe only optimization that cannot be expressed in this way is the loop-related optimizations (that calculates iteration count based on that the values do not wrap. And that \\(\\verb!a[i]!\\) and \\(\\verb!a[i+1]!\\) are adjacent, which is important for vectorization).', 'timestamp': '1494362384913', 'permalink': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment\x3d1494362384913#c6141168780416330691', 'author': {'name': 'Krister Walfridsson', 'avatarUrl': '//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/02591279630933941271'}, 'displayTime': 'May 9, 2017 at 10:39 PM', 'deleteclass': 'item-control blog-admin pid-1878224168'}];
      var msgs = {'loadMore': 'Load more...', 'loading': 'Loading...', 'loaded': 'No more!', 'addComment': 'Add comment', 'reply': 'Reply', 'delete': 'Delete'};
      var config = {'blogId': '2420869991974935734', 'postId': '8730968594439269409', 'feed': 'https://kristerw.blogspot.com/feeds/8730968594439269409/comments/default', 'authorName': 'Krister Walfridsson', 'authorUrl': 'https://www.blogger.com/profile/02591279630933941271', 'baseUri': 'https://www.blogger.com', 'maxThreadDepth': 2};

// <![CDATA[
      var cursor = null;
      if (items && items.length > 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        if (entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '<span class="deleted-comment">' + entry.content.$t + '</span>';
            }
          }
        }
        return entry.content.$t;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data && data.feed && data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author && entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid && pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&v=2&orderby=published&reverse=false&max-results=50';
          if (cursor) {
            url += '&published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length < 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              && comment.author.name == config.authorName
              && comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/delete-comment.g?blogID='
               + config.blogId + '&postID=' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox && (commentId !== replyParent)) {
          replybox.src = '';
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog && window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog && window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]>
  </script>
<div id='comment-holder'>
<div id='bc_0_17C' kind='c'><div id='bc_0_17CT'><div id='bc_0_16T' class='comment-thread' kind='r'  t='0' u='0'><ol id='bc_0_16TB'><li id='bc_0_0B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-Q3qpoOJ2OV4/AAAAAAAAAAI/AAAAAAAAaLU/qkLTIp1kkts/s35-c/photo.jpg'></img></div><div id='c7602495102647553779' class='comment-block'><div id='bc_0_0M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/12219383030985540061'>Koen Vos</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456121061202#c7602495102647553779'>February 22, 2016 at 7:04 AM</a></span></div><p id='bc_0_0MC' class='comment-content'>Nice writeup.<br />These optimizations also mean UNsigned integers should only be used when really needed. E.g. when you need the overflow wrap around.</p><span id='bc_0_0MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-171330755'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=7602495102647553779'>Delete</a></span></span></div><div id='bc_0_0BR' class='comment-replies'></div><div id='bc_0_0B_box' class='comment-replybox-single'></div></li><li id='bc_0_1B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh5.googleusercontent.com/-IJeEdrxo51U/AAAAAAAAAAI/AAAAAAAAC5g/jWdgZY43ufQ/s35-c/photo.jpg'></img></div><div id='c4243935719181113598' class='comment-block'><div id='bc_0_1M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/12416085733314329967'>Eric Lagergren</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456123345216#c4243935719181113598'>February 22, 2016 at 7:42 AM</a></span></div><p id='bc_0_1MC' class='comment-content'>In &quot;Value range calculations&quot; shouldn&#39;t it be<br /><br />    (0, INT_MAX]<br /><br />instead of<br /><br />    [0, INT_MAX]<br /><br />because the if-statement checks to make sure x &gt; 0, not x &gt;= 0?<br /><br />Great write-up!<br /></p><span id='bc_0_1MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-352747736'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=4243935719181113598'>Delete</a></span></span></div><div id='bc_0_1BR' class='comment-replies'></div><div id='bc_0_1B_box' class='comment-replybox-single'></div></li><li id='bc_0_2B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg'></img></div><div id='c5534126643132454622' class='comment-block'><div id='bc_0_2M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/02591279630933941271'>Krister Walfridsson</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456137774557#c5534126643132454622'>February 22, 2016 at 11:42 AM</a></span></div><p id='bc_0_2MC' class='comment-content'>Thanks!  I have updated the ranges in the blog post.</p><span id='bc_0_2MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1878224168'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=5534126643132454622'>Delete</a></span></span></div><div id='bc_0_2BR' class='comment-replies'></div><div id='bc_0_2B_box' class='comment-replybox-single'></div></li><li id='bc_0_3B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6818138626117414265' class='comment-block'><div id='bc_0_3M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/07587892946798135052'>Alf P. Steinbach</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456168701646#c6818138626117414265'>February 22, 2016 at 8:18 PM</a></span></div><p id='bc_0_3MC' class='comment-content'>I&#39;m afraid that as regards the C++ language you&#39;ve fallen victim to some purely associative propaganda, I&#39;m sorry: very few of the opportunities you list, are examples where the UB contributes to optimization of actual C++ code.<br /><br />[Snipped concrete discussion of first 7 cases, because that exceeded the 4096 character limit on postings. Conclusion: only 6 and 7 are real. Silly limit! Gag the critics!]<br /><br />***<br /><br />Okay there are more cases, and loops are especially interesting. They offer some valid good optimizations, and some that are more in the class of perverse compiler behavior (which you can just take as my personal opinion, or investigate, sorry I don&#39;t have more time here). But in conclusion, the optimization possibilities offered by signed arithmetic UB, are somewhat hyped up: there are some such possibilities, even some good ones, but many alleged ones are not really optimizations at all.<br /><br />Still there are good reasons for preferentially using signed integers for numbers, and those good reasons include both clarity (less complexity, more concise code), and less opportunities for e.g. promotion bugs to creep in.<br /><br />Cheers!</p><span id='bc_0_3MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-2046834556'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=6818138626117414265'>Delete</a></span></span></div><div id='bc_0_3BR' class='comment-replies'></div><div id='bc_0_3B_box' class='comment-replybox-single'></div></li><li id='bc_0_4B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg'></img></div><div id='c7911937670428840961' class='comment-block'><div id='bc_0_4M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/02591279630933941271'>Krister Walfridsson</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456184448777#c7911937670428840961'>February 23, 2016 at 12:40 AM</a></span></div><p id='bc_0_4MC' class='comment-content'>Hi Alf,<br /><br />signed overflow is undefined behavior in C++ too, and GCC does all of the described transformations for both C and C++.<br /><br />We may argue about the benefit of these transformations, but I think that is a topic for a separate blog post... :-)<br /></p><span id='bc_0_4MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1878224168'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=7911937670428840961'>Delete</a></span></span></div><div id='bc_0_4BR' class='comment-replies'></div><div id='bc_0_4B_box' class='comment-replybox-single'></div></li><li id='bc_0_5B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c2790380421495058725' class='comment-block'><div id='bc_0_5M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/07587892946798135052'>Alf P. Steinbach</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456187662148#c2790380421495058725'>February 23, 2016 at 1:34 AM</a></span></div><p id='bc_0_5MC' class='comment-content'>Oh. You misunderstood. I mentioned the language because a comment argument for optimization of sillycodes like `x*Constant &gt; x` (in one of your examples) is that such code can be generated by macros. Those are at best a C-specific arguments; there is no reason a sane C++ programmer would do this, or indeed, need to have it optimized.<br /><br />Cheers &amp; hth.,<br /><br />- Alf</p><span id='bc_0_5MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-2046834556'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=2790380421495058725'>Delete</a></span></span></div><div id='bc_0_5BR' class='comment-replies'></div><div id='bc_0_5B_box' class='comment-replybox-single'></div></li><li id='bc_0_6B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c1917980528307417386' class='comment-block'><div id='bc_0_6M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/06893028044755694147'>Matthew Fernandez</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456214423138#c1917980528307417386'>February 23, 2016 at 9:00 AM</a></span></div><p id='bc_0_6MC' class='comment-content'>@Krister, nice article!<br /><br />@Alf, I think you are underestimating the amount of C++ code written by non-humans. Many code generators produce idioms like this. Convoluted template shenanigans can also lead to such expressions appearing in a translation unit.<br /><br />@Koen, yes and no. Unsigned types are much easier to reason about in many situations. It is true that there are cases like the one Krister identified where an optimisation is only enabled when operating on signed types. However, there are so many cases of undefined behaviour relating to signed but not unsigned types that it can be a minefield for the insufficiently cautious programmer. E.g. `1 &lt;&lt; 31`, `INT_MIN / -1`, ...</p><span id='bc_0_6MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-2073609546'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=1917980528307417386'>Delete</a></span></span></div><div id='bc_0_6BR' class='comment-replies'></div><div id='bc_0_6B_box' class='comment-replybox-single'></div></li><li id='bc_0_7B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c885274766153389474' class='comment-block'><div id='bc_0_7M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/06061640618369768590'>Konz</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456396115127#c885274766153389474'>February 25, 2016 at 11:28 AM</a></span></div><p id='bc_0_7MC' class='comment-content'>@Koen: I second what Matthew is saying.  The standard says that signed overflow leads to undefined behavior.  This is because the IBM 360 and successors trapped on signed integer overflow.<br /><br />Since undefined behavior can be anything, programmers must avoid creating such code.<br /><br />Thus, modern instances of GCC and other compilers assume that programmers are infallible and have ensured that their code does not cause overflow, hence giving the compilers license to perform these optimizations.<br /><br />If however, the code was written with the assumption that signed overflow is treated exactly like unsigned arithmetic, as was the case for previous instances of these compilers on most machines, these optimization can cause the code to fail.<br /><br />Although I can understand compiler writers&#39; interest in implementing these optimizations, one hast to wonder if a programmer that creates code with such obvious optimization opportunities has really thought through his code, e.g., in regards to integer overflow.<br /><br />And honestly, I think programmers would be better served by having code generated that traps on overflow, at least for debug builds.</p><span id='bc_0_7MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1541573582'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=885274766153389474'>Delete</a></span></span></div><div id='bc_0_7BR' class='comment-replies'></div><div id='bc_0_7B_box' class='comment-replybox-single'></div></li><li id='bc_0_8B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c874743058848513818' class='comment-block'><div id='bc_0_8M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/14682465709740969828'>justesting</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1456446037148#c874743058848513818'>February 26, 2016 at 1:20 AM</a></span></div><p id='bc_0_8MC' class='comment-content'>@Konz In some cases of undefined behavior gcc and clang may use  __builtin_trap which let&#39;s say on x86 may generate a ud2 instruction which will trap. They both currently do this when dereferencing a null pointer see this godbolt example: https://goo.gl/VoV7zH<br /><br />The compiler may not always be able to prove undefined behavior, on a stackoverflow question I answered a while ago: http://stackoverflow.com/q/32506643/1708801 <br /><br />A simple cout of the variable was sufficient to confuse the compiler and prevent a warning of undefined behavior. Although the optimizer still managed to turn a finite loop into an infinite one in this case.</p><span id='bc_0_8MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-922999406'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=874743058848513818'>Delete</a></span></span></div><div id='bc_0_8BR' class='comment-replies'></div><div id='bc_0_8B_box' class='comment-replybox-single'></div></li><li id='bc_0_9B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c4874005006181033965' class='comment-block'><div id='bc_0_9M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/09213668605490237138'>Nuno Lopes</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1457286776014#c4874005006181033965'>March 6, 2016 at 6:52 PM</a></span></div><p id='bc_0_9MC' class='comment-content'>This is wrong for the case y = -1:<br />(-x) / (-y)     -&gt;   x / y<br /><br />since with y = -1 the optimized code would crash when x = INT_MAX  (the CPU traps).</p><span id='bc_0_9MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-225537378'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=4874005006181033965'>Delete</a></span></span></div><div id='bc_0_9BR' class='comment-replies'></div><div id='bc_0_9B_box' class='comment-replybox-single'></div></li><li id='bc_0_10B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-YvqX_p-_VTo/AAAAAAAAAAI/AAAAAAAAAK0/eBm7iDz3z6I/s35-c/photo.jpg'></img></div><div id='c2932635155683498927' class='comment-block'><div id='bc_0_10M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/10580600786015660715'>Sanjoy Das</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1459380060619#c2932635155683498927'>March 31, 2016 at 1:21 AM</a></span></div><p id='bc_0_10MC' class='comment-content'>Is it common to see loop like<br /><br />for (int i = 0; i &lt;= m; i++)<br /><br />?<br /><br />&quot;Most&quot;[1] loops that I&#39;ve seen are written as<br /><br />for (int i = 0; i &lt; m; i++)<br /><br />in which case you don&#39;t need UB-on-signed-overflow (you can prove no-overflow directly, even if spec is to wrap).<br /><br />[1]: In quotes since I have no way at the moment to quantify this</p><span id='bc_0_10MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-2078547692'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=2932635155683498927'>Delete</a></span></span></div><div id='bc_0_10BR' class='comment-replies'></div><div id='bc_0_10B_box' class='comment-replybox-single'></div></li><li id='bc_0_11B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/_SgvQYwGK9FU/TLYbsMAyXjI/AAAAAAAAABY/-xH3QwLk2w0/S45-s35/HeadShot.JPG'></img></div><div id='c1594801950215195854' class='comment-block'><div id='bc_0_11M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/05696394052049156443'>Jim Dempsey</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1476110668578#c1594801950215195854'>October 10, 2016 at 4:44 PM</a></span></div><p id='bc_0_11MC' class='comment-content'>When the when (m is unsigned) or (m is larger bit size than int), and m is greater than INT_MAX, then the loop will never terminate. (IOW the loop is not countable).</p><span id='bc_0_11MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-789217825'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=1594801950215195854'>Delete</a></span></span></div><div id='bc_0_11BR' class='comment-replies'></div><div id='bc_0_11B_box' class='comment-replybox-single'></div></li><li id='bc_0_13B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c5604119781768215568' class='comment-block'><div id='bc_0_13M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/09228282490456446770'>mad</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1480101851054#c5604119781768215568'>November 25, 2016 at 8:24 PM</a></span></div><p id='bc_0_13MC' class='comment-content'>There are a few cases where signed overflow is the desired behavior, although they aren&#39;t too common:<br /><br />- Generating -1 when input is negative without a branch:<br />    (int32_t)val &gt;&gt; 31; // equivalent to val &lt; 0 ? -1 : 0;<br /><br />Fast random number generator in -128 to 127 range:<br />    int32_t randMem;<br />    randMem *= 1103515245;<br />    randMem += 12345;<br />    randOut = randMem &gt;&gt; 24;<br /><br />What&#39;s the proper way to get GCC to generate the proper code in this kind of case? Cast to uint32_t to force limited range, then apply wrapping arithmetic shift right? Or is there an intrinsic as in the case of stuff like 32bit * 32bit -&gt; 64bit multiply on 32bit architectures?</p><span id='bc_0_13MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1344932561'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=5604119781768215568'>Delete</a></span></span></div><div id='bc_0_13BR' class='comment-replies'><span id='bc_0_13b+seedCLhTD' kind='d'><div id='bc_0_12T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_12TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_12TA' class='thread-arrow'></span><span id='bc_0_12TN' class='thread-count'><span id='bc_0_12TNT' style='display: none;'></span><span id='bc_0_12TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_12TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_12TC' class='thread-chrome thread-expanded'><div><li id='bc_0_12B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg'></img></div><div id='c3093548014406783131' class='comment-block'><div id='bc_0_12M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/02591279630933941271'>Krister Walfridsson</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1480354077131#c3093548014406783131'>November 28, 2016 at 6:27 PM</a></span></div><p id='bc_0_12MC' class='comment-content'>There are no relevant intrinsics, but the compiler is in general smart enough to handle many interesting cases. For example, your generation of -1 if \(\verb!val!\) is negative can be done as \(\verb!(val &lt; 0) ? -1 : 0!\) &#8212; GCC generates a shift for this!<br /><br />Or you can make your operations safe by casting to larger types/unsigned etc. For example, if you have<br />\(\verb!int32_t a, b, c;!\)<br />then you can implement a wrapping addition as<br />\(\verb!c = (int32_t)((int64_t)a + (int64_t)b);!\)<br />GCC generates a 32-bit wrapping addition for this.<br /><br />Or you can use the \(\verb!-fwrapv!\) command-line option, that treats wrapping integers as being defined (but which of course disables the optimizations described in the blog post)</p><span id='bc_0_12MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1878224168'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=3093548014406783131'>Delete</a></span></span></div><div id='bc_0_12BR' class='comment-replies'></div><div id='bc_0_12B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_12I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_12T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_13B_box' class='comment-replybox-single'></div></li><li id='bc_0_15B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c8448445659490835796' class='comment-block'><div id='bc_0_15M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/12531904492602532373'>supercat</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1487363888029#c8448445659490835796'>February 17, 2017 at 9:38 PM</a></span></div><p id='bc_0_15MC' class='comment-content'>How many genuinely-useful optimizations are enabled by treating signed overflow as UB, rather than saying that it will yield a value that behaves as any mathematical integer--not necessarily within the range of the type--whose value is congruent to the correct value mod 2&#179;&#178; (or 2&#8310;&#8308;, etc. based on type).  Such a guarantee would so far as I can tell very seldom interfere in any way with any of the optimizations you listed, but would allow programmers to write shorter and more efficient code in cases where the above behavior would satisfy application requirements, than would be possible without such a guarantee.</p><span id='bc_0_15MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-654837207'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=8448445659490835796'>Delete</a></span></span></div><div id='bc_0_15BR' class='comment-replies'><span id='bc_0_15b+seedCLhVD' kind='d'><div id='bc_0_14T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_14TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_14TA' class='thread-arrow'></span><span id='bc_0_14TN' class='thread-count'><span id='bc_0_14TNT' style='display: none;'></span><span id='bc_0_14TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_14TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_14TC' class='thread-chrome thread-expanded'><div><li id='bc_0_14B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-PGl8zAEL90E/AAAAAAAAAAI/AAAAAAAABm0/M-OPz_O-oow/s35-c/photo.jpg'></img></div><div id='c6141168780416330691' class='comment-block'><div id='bc_0_14M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/02591279630933941271'>Krister Walfridsson</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html?showComment=1494362384913#c6141168780416330691'>May 9, 2017 at 10:39 PM</a></span></div><p id='bc_0_14MC' class='comment-content'>I&#39;d say this is true for essentially all of the optimizations mentioned in the blog post &#8212; e.g. it uses the fact that wrapping is UB to be allowed to simplify e.g. \(\verb!x+1 &lt; x!\) to \(\verb!1 &lt; 0!\) by subtracting \(\verb!x!\) from both sides, but the rule could be expressed as if the operation was done in a wider type.<br /><br />The only optimization that cannot be expressed in this way is the loop-related optimizations (that calculates iteration count based on that the values do not wrap. And that \(\verb!a[i]!\) and \(\verb!a[i+1]!\) are adjacent, which is important for vectorization).</p><span id='bc_0_14MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1878224168'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2420869991974935734&amp;postID=6141168780416330691'>Delete</a></span></span></div><div id='bc_0_14BR' class='comment-replies'></div><div id='bc_0_14B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_14I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_14T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_15B_box' class='comment-replybox-single'></div></li></ol><div id='bc_0_16I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Add comment</a></div><div id='bc_0_16T_box' class='comment-replybox-thread'></div><div id='bc_0_16L' class='loadmore loaded' kind='rb'><a href='javascript:;' target='_self'>Load more...</a></div></div></div></div>
</div>
</div>
<p class='comment-footer'>
<div class='comment-form'>
<a name='comment-form'></a>
<p>
</p>
<a href='https://www.blogger.com/comment-iframe.g?blogID=2420869991974935734&postID=8730968594439269409' id='comment-editor-src'></a>
<iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410px' id='comment-editor' name='comment-editor' src='' width='100%'></iframe>
<script src='https://www.blogger.com/static/v1/jsbin/3223910711-comment_from_post_iframe.js' type='text/javascript'></script>
<script type='text/javascript'>
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script>
</div>
</p>
<div id='backlinks-container'>
<div id='Blog1_backlinks-container'>
</div>
</div>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='https://kristerw.blogspot.com/2016/03/c-pointers-are-not-hardware-pointers.html' id='Blog1_blog-pager-newer-link' title='Newer Post'>Newer Post</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='https://kristerw.blogspot.com/2016/01/more-turing-completeness-in-surprising.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='https://kristerw.blogspot.com/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='https://kristerw.blogspot.com/feeds/8730968594439269409/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
<script type='text/javascript'>
    window.___gcfg = { 'lang': 'en' };
  </script>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget HTML' data-version='1' id='HTML1'>
<h2 class='title'>About this blog</h2>
<div class='widget-content'>
<div style="text-align: justify;">I blog about my pet projects, papers I read, and other things I find interesting &mdash; mostly as a way to organize my thoughts.</div><br/>

<a href="https://twitter.com/kwalfridsson" class="twitter-follow-button" data-show-count="false">Follow @kwalfridsson</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2420869991974935734&widgetType=HTML&widgetId=HTML1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("HTML1"));' target='configHTML1' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/'>
2017
</a>
<span class='post-count' dir='ltr'>(22)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/09/'>
September 2017
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/08/'>
August 2017
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/07/'>
July 2017
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/06/'>
June 2017
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/05/'>
May 2017
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/04/'>
April 2017
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/03/'>
March 2017
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/02/'>
February 2017
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2017/01/'>
January 2017
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/'>
2016
</a>
<span class='post-count' dir='ltr'>(23)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/12/'>
December 2016
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/11/'>
November 2016
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/10/'>
October 2016
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/09/'>
September 2016
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/08/'>
August 2016
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/07/'>
July 2016
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/06/'>
June 2016
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/05/'>
May 2016
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/04/'>
April 2016
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/03/'>
March 2016
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/02/'>
February 2016
</a>
<span class='post-count' dir='ltr'>(1)</span>
<ul class='posts'>
<li><a href='https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html'>How undefined signed overflow enables optimization...</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2016/01/'>
January 2016
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/'>
2015
</a>
<span class='post-count' dir='ltr'>(17)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/10/'>
October 2015
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/08/'>
August 2015
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/07/'>
July 2015
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/06/'>
June 2015
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/05/'>
May 2015
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/04/'>
April 2015
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/03/'>
March 2015
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://kristerw.blogspot.com/2015/02/'>
February 2015
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2420869991974935734&widgetType=BlogArchive&widgetId=BlogArchive1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("BlogArchive1"));' target='configBlogArchive1' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div><div class='widget Label' data-version='1' id='Label1'>
<h2>Labels</h2>
<div class='widget-content list-label-widget-content'>
<ul>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/GCC'>GCC</a>
<span dir='ltr'>(33)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/C'>C</a>
<span dir='ltr'>(20)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/C%2B%2B'>C++</a>
<span dir='ltr'>(13)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/undefined%20behavior'>undefined behavior</a>
<span dir='ltr'>(9)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/SPIR-V'>SPIR-V</a>
<span dir='ltr'>(7)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/backend'>backend</a>
<span dir='ltr'>(5)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/Turing-complete'>Turing-complete</a>
<span dir='ltr'>(4)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/x86'>x86</a>
<span dir='ltr'>(4)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/SMT%20solver'>SMT solver</a>
<span dir='ltr'>(2)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/Epiphany'>Epiphany</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/NetBSD'>NetBSD</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/RISC-V'>RISC-V</a>
<span dir='ltr'>(1)</span>
</li>
<li>
<a dir='ltr' href='https://kristerw.blogspot.com/search/label/nvptx'>nvptx</a>
<span dir='ltr'>(1)</span>
</li>
</ul>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2420869991974935734&widgetType=Label&widgetId=Label1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("Label1"));' target='configLabel1' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div><div class='widget HTML' data-version='1' id='HTML2'>
<div class='widget-content'>
<a href="http://feeds.feedburner.com/KristerWalfridssonsBlog" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"><img src="//feedburner.google.com/fb/images/pub/feed-icon16x16.png" alt="" style="border:0"/></a>
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2420869991974935734&widgetType=HTML&widgetId=HTML2&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("HTML2"));' target='configHTML2' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot no-items section' id='footer-1'></div>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Simple theme. Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2420869991974935734&widgetType=Attribution&widgetId=Attribution1&action=editWidget&sectionId=footer-3' onclick='return _WidgetManager._PopupConfig(document.getElementById("Attribution1"));' target='configAttribution1' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>
<script src='https://apis.google.com/js/plusone.js' type='text/javascript'></script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/3392677022-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY4WuVlvOHAq9IBZNbloZQlyUMqyxg:1505855510214';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d2420869991974935734','//kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html','2420869991974935734');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '2420869991974935734', 'title': 'Krister Walfridsson&#8217;s blog', 'url': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html', 'canonicalUrl': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html', 'homepageUrl': 'https://kristerw.blogspot.com/', 'searchUrl': 'https://kristerw.blogspot.com/search', 'canonicalHomepageUrl': 'https://kristerw.blogspot.com/', 'blogspotFaviconUrl': 'https://kristerw.blogspot.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': 'UA-83654896-1', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Krister Walfridsson&#8217;s blog - Atom\x22 href\x3d\x22https://kristerw.blogspot.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Krister Walfridsson&#8217;s blog - RSS\x22 href\x3d\x22https://kristerw.blogspot.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Krister Walfridsson&#8217;s blog - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/2420869991974935734/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Krister Walfridsson&#8217;s blog - Atom\x22 href\x3d\x22https://kristerw.blogspot.com/feeds/8730968594439269409/comments/default\x22 /\x3e\n', 'meTag': '', 'openIdOpTag': '', 'googleProfileUrl': 'https://plus.google.com/115659629692746830116', 'adsenseClientId': 'ca-pub-1115671200223151', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'ieCssRetrofitLinks': '\x3c!--[if IE]\x3e\x3cscript type\x3d\x22text/javascript\x22 src\x3d\x22https://www.blogger.com/static/v1/jsbin/35781802-ieretrofit.js\x22\x3e\x3c/script\x3e\n\x3c![endif]--\x3e', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/770dc096d8973eb2', 'plusOneApiSrc': 'https://apis.google.com/js/plusone.js', 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Google+', 'key': 'googlePlus', 'shareMessage': 'Share to Google+', 'target': 'googleplus'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'googlePlusShareButtonWidth': 300, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '8730968594439269409', 'pageName': 'How undefined signed overflow enables optimizations in GCC', 'pageTitle': 'Krister Walfridsson&#8217;s blog: How undefined signed overflow enables optimizations in GCC'}}, {'name': 'features', 'data': {'lazy_images': 'false', 'unsupported_browser_message': 'false', 'lightbox_img_parsing': 'false', 'video_theatre_support': 'false', 'sharing_get_link_dialog': 'false'}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'custom', 'localizedName': 'Custom', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': true, 'variant': 'simplysimple', 'variantId': 'simplysimple', 'variantName': 'Simply Simple', 'localizedVariantName': 'Simply Simple'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'How undefined signed overflow enables optimizations in GCC', 'description': ' Signed integers are not allowed to overflow in C and C++, and this helps compilers generate better code. I was interested in how GCC is tak...', 'url': 'https://kristerw.blogspot.com/2016/02/how-undefined-signed-overflow-enables.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 8730968594439269409}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', null, document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', null, document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', null, document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/2126239805-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/368954415-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HTMLView', new _WidgetInfo('HTML1', 'sidebar-right-1', null, document.getElementById('HTML1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', null, document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LabelView', new _WidgetInfo('Label1', 'sidebar-right-1', null, document.getElementById('Label1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HTMLView', new _WidgetInfo('HTML2', 'sidebar-right-1', null, document.getElementById('HTML2'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', null, document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>